[toc]

### 编译流程

1. 预处理（进行宏替换）

   预处理功能主要包括宏定义、文件包含、条件编译、去注释等，预处理指令以`#`号开头。

   `gcc -E hello.c -o hello.i`

   `-E`指定gcc在预处理结束后停止编译，`-o`指目标文件，`.i`文件为经过预处理后C原始程序。

2. 编译（生成汇编）

   检查代码规范性、语法错误等，然后将代码翻译成汇编语言。

   `gcc -S hello.i -o hello.s`

   `-S`指定只进行编译不进行汇编，生成汇编代码。

3. 汇编（生成机器可识别代码）

   将编译阶段生成的`.s`文件转成目标文件。

   `gcc -c hello.s -o hello.o`

4. 链接（生成可执行文件或库文件）

   `gcc hello.o -o hello`

### 函数库

比如`printf`函数的实现并不在C程序里，且预编译包含的`stdio.h`也只有该函数的声明。

这些函数存在函数库中，如动态库`.so`（linux）、`.dll`（.windows），静态库`.a`（linux）、`.lib`。

静态库在编译链接时将库文件代码全部加入到可执行文件中，后缀为`.a`。动态库则是在程序执行时由运行时链接文件去加载库，`.so`，如`libc.so.6`是标准C库的共享库，提供C语言的基本功能和系统调用接口。

### gcc选项

- E：只激活预处理，不生成文件，需要指定一个重定向的输出文件
- S：编译到汇编语言
- c：编译到目标代码
- o：文件输出到目标文件
- static：采用静态链接
- g：生成调试信息
- shared：尽量使用动态库
- O0、O1、O2、O3：编译器的4个优化选项，-O0没有优化，-O1为缺省值，-O3优化级别最高
- w：不生成任何警告信息
- Wall：生成所有警告信息

